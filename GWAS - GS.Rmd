---
title: "GWAS incorporation on GS"
author: "Anngie Hernandez"
date: "25/4/2023"
output: html_document
---

[**GS AND MAS ANALYSIS WITH 75% OF HERITABILITY, 20 QTNs, 80% OF TRAINING POPULATION AND 20% OF TESTING POPULATION**]{.ul}

```{r include=FALSE}
#importing data
options(repos = list(CRAN="http://cran.rstudio.com/"))
source("http://zzlab.net/GAPIT/gapit_functions.txt")
myGM <- read.csv("~/myGM.txt", sep="")
myGD <- read.csv("~/myGD.txt", sep="")
```

Sampling 80% training and 20% testing population

```{r echo=TRUE}
#Sampling 80% training and 20% testing population, set.seed(99164)
n=nrow(myGD)
testing20=sample(n,round(n/5),replace=F)
training80=-testing20
```

Phenotype simulation 75% heritability and 20 QTNs

```{r}
#Phenotype simulation 75% heritability and 20 QTNs
set.seed(99164) 
mySim=GAPIT.Phenotype.Simulation(GD=myGD, GM=myGM,
h2=.75,
NQTN=20, 
QTNDist="normal")
```

GWAS using BLINK with 20QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, results='hide', warning=FALSE}
#GWAS using BLINK with 20QTNs, 75% heritability, 80% training population and 20% testing population
#GWAS
myGAPIT1 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh75QTN20training80=myGAPIT1$PCA
index=myGAPIT1$GWAS[,4]<0.05/length(myGAPIT1$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT1$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 20QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}

#MAS using the SNPs selected from the BLINK analysis with 20QTNs, 75% heritability, 80% training population and 20% testing population

#MAS
myGAPIT2 <- GAPIT(
Y=mySim$Y[training80,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT2$Pred[,1])
myPred=myGAPIT2$Pred[order,]
ru2MASh75QTN20training80=cor(myPred[testing20,8],mySim$u[testing20])^2
ru2MASh75QTN20training80
```

gBLUP with 20QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 20QTNs, 75% heritability, 80% training population and 20% testing population
myGAPIT3 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT3$Pred[,1])
myPred=myGAPIT3$Pred[order,]
ru2gbluph75QTN20training80=cor(myPred[testing20,5],mySim$u[testing20])^2
ru2gbluph75QTN20training80
```

gBLUP including GWAs-selected SNPs with 20QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 20 QTNs, 75 heritability and 80% training population
myGAPIT4<- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT4$Pred[,1])
myPred=myGAPIT4$Pred[order,]
ru2gblupgwash75QTNs20training80=cor(as.numeric(myPred[testing20,8]),mySim$u[testing20])^2
ru2gblupgwash75QTNs20training80
```

[Bayesian models]{.ul}

```{r Install package BGLR, include=FALSE}
install.packages("BGLR") 
library(BGLR)
```

Bayes A 20QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 20QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN20training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs20training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesAh75QTNs20training80
```

Bayes B 20QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
# Bayes B 20QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN20training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesBh75QTNs20training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesBh75QTNs20training80
```

Bayes LASSO 20QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes LASSO 20QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN20training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BL', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesLASSOh75QTNs20training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesLASSOh75QTNs20training80

```

Bayes Ridge Regression 20QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes Ridge Regression 20QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN20training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BRR', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesRRh75QTNs20training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesRRh75QTNs20training80
```

[**GS AND MAS ANALYSIS WITH 75% OF HERITABILITY, 20 QTNs, EVALUATING DIFFERENT TRAINING POPULATION SIZES**]{.ul}

**Sampling 90% training population and 10% testing population**

```{r echo=TRUE}
#Sampling 50% of training and testing population
set.seed(99164)
n=nrow(myGD)
testing10=sample(n,round(n/9.99999999),replace=F)
training90=-testing10
```

GWAS using BLINK with 20QTNs, 75% heritability, 90% training population and 10% testing population

```{r  echo=TRUE, results='hide', warning=FALSE}

#GWAS using BLINK with 20QTNs, 75% heritability, 90% training population and 10% testing population
#GWAS
myGAPIT5 <- GAPIT(
Y=mySim$Y[training90,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh75QTN20training90=myGAPIT5$PCA
index=myGAPIT5$GWAS[,4]<0.05/length(myGAPIT5$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT5$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 20QTNs, 75% heritability, 90% training population and 10% testing population

```{r  echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#MAS using the SNPs selected from the BLINK analysis with 20QTNs, 75% heritability, 90% training population and 10% testing population
#MAS
myGAPIT6 <- GAPIT(
Y=mySim$Y[training90,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT6$Pred[,1])
myPred=myGAPIT6$Pred[order,]
ru2MASh75QTN20training90=cor(myPred[testing10,8],mySim$u[testing10])^2
ru2MASh75QTN20training90
```

gBLUP with 20QTNs, 75% heritability, 90% training population and 10% testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 20QTNs, 75% heritability, 90% training population and 10% testing population
myGAPIT7 <- GAPIT(
Y=mySim$Y[training90,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT7$Pred[,1])
myPred=myGAPIT7$Pred[order,]
ru2gbluph75QTN20training90=cor(myPred[testing10,5],mySim$u[testing10])^2
ru2gbluph75QTN20training90
```

gBLUP including GWAs-selected SNPs with 20QTNs, 75% heritability, 90% training population and 10% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 20 QTNs, 75 heritability and 90% training population
myGAPIT8<- GAPIT(
Y=mySim$Y[training90,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT8$Pred[,1])
myPred=myGAPIT8$Pred[order,]
ru2gblupgwash75QTNs20training90=cor(as.numeric(myPred[testing10,8]),mySim$u[testing10])^2
ru2gblupgwash75QTNs20training90
```

[Bayesian models]{.ul}

Bayes A 20QTNs, 75% heritability, 90% training population and 10% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 20QTNs, 75% heritability, 90% training population and 10% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training90,2]),
             ETA=list(list(X=myCVh75QTN20training90[training90,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training90,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing10,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs20training90 <- cor(mySim$u[testing10],pred.inf)^2
ru2BayesAh75QTNs20training90
```

Bayes B 20QTNs, 75% heritability, 90% training population and 10% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes B 20QTNs, 75% heritability, 90% training population and 10% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training90,2]),
             ETA=list(list(X=myCVh75QTN20training90[training90,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training90,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing10,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesBh75QTNs20training90 <- cor(mySim$u[testing10],pred.inf)^2
ru2BayesBh75QTNs20training90
```

Bayes LASSO 20QTNs, 75% heritability, 90% training population and 10% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes LASSO 20QTNs, 75% heritability, 90% training population and 10% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training90,2]),
             ETA=list(list(X=myCVh75QTN20training90[training90,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training90,-1]),model='BL', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing10,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesLASSOh75QTNs20training90 <- cor(mySim$u[testing10],pred.inf)^2
ru2BayesLASSOh75QTNs20training90
```

Bayes Ridge Regression 20QTNs, 75% heritability, 90% training population and 10% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes Ridge Regression 20QTNs, 75% heritability, 90% training population and 10% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training90,2]),
             ETA=list(list(X=myCVh75QTN20training90[training90,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training90,-1]),model='BRR', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing10,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesRRh75QTNs20training90 <- cor(mySim$u[testing10],pred.inf)^2
ru2BayesRRh75QTNs20training90
```

**Sampling 75% training and 25% testing population**

```{r echo=TRUE}
#Sampling 75% training and 25% testing population
set.seed(99164)
n=nrow(myGD)
testing25=sample(n,round(n/4),replace=F)
training75=-testing25
```

GWAS using BLINK with 20QTNs, 75% heritability, 75% training population and 25% testing population

```{r echo=TRUE, results='hide', warning=FALSE}
#GWAS using BLINK with 20QTNs, 75% heritability, 75% training population and 25% testing population
#GWAS
myGAPIT9 <- GAPIT(
Y=mySim$Y[training75,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh75QTN20training75=myGAPIT9$PCA
index=myGAPIT9$GWAS[,4]<0.05/length(myGAPIT9$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT9$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 20QTNs, 75% heritability, 75% training population and 25% testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#MAS using the SNPs selected from the BLINK analysis with 20QTNs, 75% heritability, 75% training population and 25% testing population, 
#MAS
myGAPIT10 <- GAPIT(
Y=mySim$Y[training75,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT10$Pred[,1])
myPred=myGAPIT10$Pred[order,]
ru2MASh75QTN20training75=cor(myPred[testing25,8],mySim$u[testing25])^2
ru2MASh75QTN20training75
```

gBLUP with 20QTNs, 75% heritability, 75% training population and 25% testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 20QTNs, 75% heritability, 90% training population and 10% testing population
myGAPIT11 <- GAPIT(
Y=mySim$Y[training75,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT11$Pred[,1])
myPred=myGAPIT11$Pred[order,]
ru2gbluph75QTN20training75=cor(myPred[testing25,5],mySim$u[testing25])^2
ru2gbluph75QTN20training75
```

gBLUP including GWAs-selected SNPs with 20QTNs, 75% heritability, 75% training population and 25% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 20 QTNs, 75 heritability and 90% training population
myGAPIT12<- GAPIT(
Y=mySim$Y[training75,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT8$Pred[,1])
myPred=myGAPIT12$Pred[order,]
ru2gblupgwash75QTNs20training75=cor(as.numeric(myPred[testing25,8]),mySim$u[testing25])^2
ru2gblupgwash75QTNs20training75
```

[Bayesian models]{.ul}

Bayes A 20QTNs, 75% heritability, 75% training population and 25% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 20QTNs, 75% heritability, 75% training population and 25% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training75,2]),
             ETA=list(list(X=myCVh75QTN20training75[training75,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training75,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing25,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs20training75 <- cor(mySim$u[testing25],pred.inf)^2
ru2BayesAh75QTNs20training75
```

Bayes B 20QTNs, 75% heritability, 75% training population and 25% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes B 20QTNs, 75% heritability, 75% training population and 25% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training75,2]),
             ETA=list(list(X=myCVh75QTN20training75[training75,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training75,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing25,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesBh75QTNs20training75 <- cor(mySim$u[testing25],pred.inf)^2
ru2BayesBh75QTNs20training75
```

Bayes LASSO 20QTNs, 75% heritability, 75% training population and 25% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes LASSO 20QTNs, 75% heritability, 75% training population and 25% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training75,2]),
             ETA=list(list(X=myCVh75QTN20training75[training75,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training75,-1]),model='BL', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing25,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesLASSOh75QTNs20training75 <- cor(mySim$u[testing25],pred.inf)^2
ru2BayesLASSOh75QTNs20training75
```

Bayes Ridge Regression 20QTNs, 75% heritability, 75% training population and 25% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes Ridge regression 20QTNs, 75% heritability, 75% training population and 25% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training75,2]),
             ETA=list(list(X=myCVh75QTN20training75[training75,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training75,-1]),model='BRR', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing25,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesRRh75QTNs20training75 <- cor(mySim$u[testing25],pred.inf)^2
ru2BayesRRh75QTNs20training75
```

**Sampling 50% of training and testing population**

```{r echo=TRUE}
#Sampling 50% of training and testing population
set.seed(99164)
n=nrow(myGD)
testing50=sample(n,round(n/2),replace=F)
training50=-testing50
```

GWAS using BLINK with 20QTNs, 75% heritability, 50% of training and testing population

```{r echo=TRUE, results='hide', warning=FALSE}
#GWAS using BLINK with 20QTNs, 75% heritability, 50% of training and testing population
#GWAS
myGAPIT13 <- GAPIT(
Y=mySim$Y[training50,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh75QTN20training50=myGAPIT13$PCA
index=myGAPIT13$GWAS[,4]<0.05/length(myGAPIT13$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT13$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 20QTNs, 50% of training and testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#MAS using the SNPs selected from the BLINK analysis with 20QTNs, 75% heritability, 50% of training and testing population 
#MAS
myGAPIT14 <- GAPIT(
Y=mySim$Y[training50,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT14$Pred[,1])
myPred=myGAPIT14$Pred[order,]
ru2MASh75QTN20training50=cor(myPred[testing50,8],mySim$u[testing50])^2
ru2MASh75QTN20training50
```

gBLUP with 20QTNs, 75% heritability, 50% of training and testing population 

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 20QTNs, 75% heritability, 50% of training and testing population 
myGAPIT15 <- GAPIT(
Y=mySim$Y[training50,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT15$Pred[,1])
myPred=myGAPIT15$Pred[order,]
ru2gbluph75QTN20training50=cor(myPred[testing50,5],mySim$u[testing50])^2
ru2gbluph75QTN20training50
```

gBLUP including GWAs-selected SNPs with 20QTNs, 75% heritability, 50% of training and testing population 

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 20 QTNs, 50% of training and testing population 
myGAPIT16<- GAPIT(
Y=mySim$Y[training50,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT16$Pred[,1])
myPred=myGAPIT16$Pred[order,]
ru2gblupgwash75QTNs20training50=cor(as.numeric(myPred[testing50,8]),mySim$u[testing50])^2
ru2gblupgwash75QTNs20training50
```

[Bayesian models]{.ul}

Bayes A 20QTNs, 75% heritability, 50% of training and testing population 

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 20QTNs, 75% heritability, 50% of training and testing population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training50,2]),
             ETA=list(list(X=myCVh75QTN20training50[training50,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training50,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing50,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs20training50 <- cor(mySim$u[testing50],pred.inf)^2
ru2BayesAh75QTNs20training50
```

Bayes B 20QTNs, 75% heritability, 50% of training and testing population 

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes B 20QTNs, 75% heritability, 50% of training and testing population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training50,2]),
             ETA=list(list(X=myCVh75QTN20training50[training50,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training50,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing50,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs20training50 <- cor(mySim$u[testing50],pred.inf)^2
ru2BayesAh75QTNs20training50
```

Bayes LASSO 20QTNs, 75% heritability, 50% of training and testing population 
 population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes LASSO 20QTNs, 75% heritability, 50% of training and testing population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training50,2]),
             ETA=list(list(X=myCVh75QTN20training50[training50,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training50,-1]),model='BL', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing50,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs20training50 <- cor(mySim$u[testing50],pred.inf)^2
ru2BayesAh75QTNs20training50
```

Bayes Ridge Regression 20QTNs, 75% heritability, 50% of training and testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
##Bayes Ridge Regression 20QTNs, 75% heritability, 50% of training and testing population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training50,2]),
             ETA=list(list(X=myCVh75QTN20training50[training50,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training50,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing50,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs20training50 <- cor(mySim$u[testing50],pred.inf)^2
ru2BayesAh75QTNs20training50
```

**Sampling 20% of training and 80% of testing population**

```{r echo=TRUE}
#Sampling 20% of training and 80% of testing population
set.seed(99164)
n=nrow(myGD)
testing80=sample(n,round(n/1.25),replace=F)
training20=-testing80
```

GWAS using BLINK with 20QTNs, 75% heritability,20% of training and 80% of testing population

```{r echo=TRUE, results='hide', warning=FALSE}
#GWAS using BLINK with 20QTNs, 75% heritability, 20% of training and 80% of testing population
#GWAS
myGAPIT17 <- GAPIT(
Y=mySim$Y[training20,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh75QTN20training20=myGAPIT17$PCA
index=myGAPIT17$GWAS[,4]<0.05/length(myGAPIT17$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT17$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 20QTNs, 20% of training and 80% of testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#MAS using the SNPs selected from the BLINK analysis with 20QTNs, 75% heritability, 20% of training and 80% of testing population
#MAS
myGAPIT18 <- GAPIT(
Y=mySim$Y[training20,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT18$Pred[,1])
myPred=myGAPIT18$Pred[order,]
ru2MASh75QTN20training20=cor(myPred[testing80,8],mySim$u[testing80])^2
ru2MASh75QTN20training20
```

gBLUP with 20QTNs, 75% heritability, 20% of training and 80% of testing population
```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 20QTNs, 75% heritability, 20% of training and 80% of testing population
myGAPIT19 <- GAPIT(
Y=mySim$Y[training20,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT19$Pred[,1])
myPred=myGAPIT19$Pred[order,]
ru2gbluph75QTN20training20=cor(myPred[testing80,5],mySim$u[testing80])^2
ru2gbluph75QTN20training20
```

gBLUP including GWAs-selected SNPs with 20QTNs, 75% heritability, 50% of training and testing population 

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 20 QTNs, 20% of training and 80% of testing population
myGAPIT20<- GAPIT(
Y=mySim$Y[training20,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT20$Pred[,1])
myPred=myGAPIT20$Pred[order,]
ru2gblupgwash75QTNs20training20=cor(as.numeric(myPred[testing80,8]),mySim$u[testing80])^2
ru2gblupgwash75QTNs20training20
```

[Bayesian models]{.ul}

Bayes A 20QTNs, 75% heritability, 20% of training and 80% of testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 20QTNs, 75% heritability, 20% of training and 80% of testing population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training20,2]),
             ETA=list(list(X=myCVh75QTN20training20[training20,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training20,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing80,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs20training20 <- cor(mySim$u[testing80],pred.inf)^2
ru2BayesAh75QTNs20training20
```

Bayes B 20QTNs, 75% heritability, 20% of training and 80% of testing population  

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes B 20QTNs, 75% heritability, 20% of training and 80% of testing population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training20,2]),
             ETA=list(list(X=myCVh75QTN20training20[training20,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training20,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing80,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesBh75QTNs20training20 <- cor(mySim$u[testing80],pred.inf)^2
ru2BayesBh75QTNs20training20
```

Bayes LASSO 20QTNs, 75% heritability, 20% of training and 80% of testing population 

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes LASSO 20QTNs, 75% heritability, 20% of training and 80% of testing population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training20,2]),
             ETA=list(list(X=myCVh75QTN20training20[training20,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training20,-1]),model='BL', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing80,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesLASSOh75QTNs20training20 <- cor(mySim$u[testing80],pred.inf)^2
ru2BayesLASSOh75QTNs20training20
```

Bayes Ridge Regression 20QTNs, 75% heritability, 20% of training and 80% of testing population 

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
##Bayes Ridge Regression 20QTNs, 75% heritability, 20% of training and 80% of testing population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training20,2]),
             ETA=list(list(X=myCVh75QTN20training20[training20,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training20,-1]),model='BRR', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing80,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesRRh75QTNs20training20 <- cor(mySim$u[testing80],pred.inf)^2
ru2BayesRRh75QTNs20training20
```

**Sampling 10% of training and 90% of testing population**

```{r echo=TRUE}
#Sampling 20% of training and 80% of testing population
set.seed(99164)
n=nrow(myGD)
testing90=sample(n,round(n/1.11111111111111),replace=F)
training10=-testing90
```

GWAS using BLINK with 20QTNs, 75% heritability,10% of training and 90% of testing population

```{r echo=TRUE, results='hide', warning=FALSE}
#GWAS using BLINK with 20QTNs, 75% heritability, 10% of training and 90% of testing population
#GWAS
myGAPIT21 <- GAPIT(
Y=mySim$Y[training10,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh75QTN20training10=myGAPIT20$PCA
index=myGAPIT20$GWAS[,4]<0.05/length(myGAPIT20$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT20$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 20QTNs, 10% of training and 90% of testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#MAS using the SNPs selected from the BLINK analysis with 20QTNs, 75% heritability, 10% of training and 90% of testing population
#MAS
myGAPIT22 <- GAPIT(
Y=mySim$Y[training10,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT22$Pred[,1])
myPred=myGAPIT22$Pred[order,]
ru2MASh75QTN20training10=cor(myPred[testing90,8],mySim$u[testing90])^2
ru2MASh75QTN20training10
```

gBLUP with 20QTNs, 75% heritability, 10% of training and 90% of testing population
```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 20QTNs, 75% heritability, 10% of training and 90% of testing population
myGAPIT23 <- GAPIT(
Y=mySim$Y[training10,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT23$Pred[,1])
myPred=myGAPIT23$Pred[order,]
ru2gbluph75QTN20training10=cor(myPred[testing90,5],mySim$u[testing90])^2
ru2gbluph75QTN20training10
```

gBLUP including GWAs-selected SNPs with 20QTNs, 75% heritability, 10% of training and 90% of testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 20 QTNs, 10% of training and 90% of testing population population
myGAPIT24<- GAPIT(
Y=mySim$Y[training10,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT24$Pred[,1])
myPred=myGAPIT24$Pred[order,]
ru2gblupgwash75QTNs20training10=cor(as.numeric(myPred[testing90,8]),mySim$u[testing90])^2
ru2gblupgwash75QTNs20training10
```

[Bayesian models]{.ul}

Bayes A 20QTNs, 75% heritability, 10% of training and 90% of testing population population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 20QTNs, 75% heritability, 10% of training and 90% of testing population population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training10,2]),
             ETA=list(list(X=myCVh75QTN20training10[training10,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training10,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing90,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs20training10 <- cor(mySim$u[testing90],pred.inf)^2
ru2BayesAh75QTNs20training10
```

Bayes B 20QTNs, 75% heritability, 10% of training and 90% of testing population population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes B 20QTNs, 75% heritability, 10% of training and 90% of testing population population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training10,2]),
             ETA=list(list(X=myCVh75QTN20training10[training10,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training10,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing90,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesBh75QTNs20training10 <- cor(mySim$u[testing90],pred.inf)^2
ru2BayesBh75QTNs20training10
```

Bayes LASSO 20QTNs, 75% heritability, 10% of training and 90% of testing population population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes LASSO 20QTNs, 75% heritability, 10% of training and 90% of testing population population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training10,2]),
             ETA=list(list(X=myCVh75QTN20training10[training10,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training10,-1]),model='BL', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing90,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesLASSOh75QTNs20training10 <- cor(mySim$u[testing90],pred.inf)^2
ru2BayesLASSOh75QTNs20training10
```

Bayes Ridge Regression 20QTNs, 75% heritability, 10% of training and 90% of testing population population
 
```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes Ridge Regression 20QTNs, 75% heritability, 10% of training and 90% of testing population population 
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training10,2]),
             ETA=list(list(X=myCVh75QTN20training10[training10,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training10,-1]),model='BRR', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing90,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesRRh75QTNs20training10 <- cor(mySim$u[testing90],pred.inf)^2
ru2BayesRRh75QTNs20training10
```

[**GS AND MAS ANALYSIS WITH 20 QTNs, 80% OF TRAINING POPULATION, EVALUATING DIFFERENT HERITABILITIES**]{.ul}

**Heritability 25**

Phenotype simulation 25% heritability and 20 QTNs

```{r}
#Phenotype simulation 50% heritability and 20 QTNs
set.seed(99164) 
mySim=GAPIT.Phenotype.Simulation(GD=myGD, GM=myGM,
h2=.25,
NQTN=20, 
QTNDist="normal")
```

GWAS using BLINK with 20QTNs, 25% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, results='hide', warning=FALSE}

#GWAS using BLINK with 20QTNs, 25% heritability, 80% training population and 20% testing population
#GWAS
myGAPIT25 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh25QTN20training80=myGAPIT25$PCA
index=myGAPIT25$GWAS[,4]<0.05/length(myGAPIT25$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT25$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 20QTNs, 25% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#MAS using the SNPs selected from the BLINK analysis with 20QTNs, 25% heritability, 80% training population and 20% testing population
#MAS
myGAPIT26 <- GAPIT(
Y=mySim$Y[training80,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT26$Pred[,1])
myPred=myGAPIT26$Pred[order,]
ru2MASh25QTN20training80=cor(myPred[testing20,8],mySim$u[testing20])^2
ru2MASh25QTN20training80
```

gBLUP with 20QTNs, 25% heritability, 80% training population and 20% testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 20QTNs, 25% heritability, 80% training population and 20% testing population
myGAPIT27 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT27$Pred[,1])
myPred=myGAPIT27$Pred[order,]
ru2gbluph25QTN20training80=cor(myPred[testing20,5],mySim$u[testing20])^2
ru2gbluph25QTN20training80
```

gBLUP including GWAs-selected SNPs with 20QTNs, 25% heritability, 80% training population and 20% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 20 QTNs, 25% heritability, 80% training population and 20% testing population
myGAPIT28<- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT28$Pred[,1])
myPred=myGAPIT28$Pred[order,]
ru2gblupgwash25QTNs20training80=cor(as.numeric(myPred[testing20,8]),mySim$u[testing20])^2
ru2gblupgwash25QTNs20training80
```

[Bayesian models]{.ul}

Bayes A 20QTNs, 25% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 20QTNs, 25% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh25QTN20training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh25QTNs20training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesAh25QTNs20training80
```

Bayes B 20QTNs, 25% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes B 20QTNs, 25% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh25QTN20training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesBh25QTNs20training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesBh25QTNs20training80
```

Bayes Ridge Regression 20QTNs, 25% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes Ridge Regression 20QTNs, 25% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh25QTN20training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BRR', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesRRh25QTNs20training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesRRh25QTNs20training80
```

**Heritability 50%**

Phenotype simulation 50% heritability and 20 QTNs

```{r}
#Phenotype simulation 50% heritability and 20 QTNs
set.seed(99164) 
mySim=GAPIT.Phenotype.Simulation(GD=myGD, GM=myGM,
h2=.50,
NQTN=20, 
QTNDist="normal")
```

GWAS using BLINK with 20QTNs, 50% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, results='hide', warning=FALSE}

#GWAS using BLINK with 20QTNs, 50% heritability, 80% training population and 20% testing population
#GWAS
myGAPIT29 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh50QTN20training80=myGAPIT29$PCA
index=myGAPIT29$GWAS[,4]<0.05/length(myGAPIT29$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT29$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 20QTNs, 50% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#MAS using the SNPs selected from the BLINK analysis with 20QTNs, 50% heritability, 80% training population and 20% testing population
#MAS
myGAPIT30 <- GAPIT(
Y=mySim$Y[training80,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT30$Pred[,1])
myPred=myGAPIT30$Pred[order,]
ru2MASh50QTN20training80=cor(myPred[testing20,8],mySim$u[testing20])^2
ru2MASh50QTN20training80
```

gBLUP with 20QTNs, 50% heritability, 80% training population and 20% testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 20QTNs, 50% heritability, 80% training population and 20% testing population
myGAPIT31 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT31$Pred[,1])
myPred=myGAPIT31$Pred[order,]
ru2gbluph50QTN20training80=cor(myPred[testing20,5],mySim$u[testing20])^2
ru2gbluph50QTN20training80
```

gBLUP including GWAs-selected SNPs with 20QTNs, 50% heritability, 80% training population and 20% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 20 QTNs, 50% heritability, 80% training population and 20% testing population
myGAPIT32<- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT32$Pred[,1])
myPred=myGAPIT32$Pred[order,]
ru2gblupgwash50QTNs20training80=cor(as.numeric(myPred[testing20,8]),mySim$u[testing20])^2
ru2gblupgwash50QTNs20training80
```

[Bayesian models]{.ul}

Bayes A 20QTNs, 50% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 20QTNs, 50% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh50QTN20training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh50QTNs20training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesAh50QTNs20training80
```

Bayes B 20QTNs, 50% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes B 20QTNs, 50% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh50QTN20training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesBh50QTNs20training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesBh50QTNs20training80
```

Bayes LASSO 20QTNs, 50% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes LASSO 20QTNs, 25% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh50QTN20training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BL', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesLASSOh50QTNs20training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesLASSOh50QTNs20training80
```

**Heritability 75%**

Heritability of 75, sampling 20 QTNs and evaluating the 80% as the training population was estimated for all models considered in the selection, the results are shown in the chunks 2-12.

[**GS AND MAS ANALYSIS WITH 80% OF TRAINING POPULATION, HERITABILITY OF 75%, EVALUATING DIFFERENT NUMBERS OF QTNs**]{.ul}

**20 QTNs**

20 QTNs, assuming an heritability of te 75% and evaluating the 80% as the training population was estimated for all models considered in the selection, the results are shown in the chunks 2-12.

**40 QTNs**

Phenotype simulation 75% heritability and 40 QTNs

```{r}
#Phenotype simulation 75% heritability and 40 QTNs
set.seed(99164) 
mySim=GAPIT.Phenotype.Simulation(GD=myGD, GM=myGM,
h2=.75,
NQTN=40, 
QTNDist="normal")
```

GWAS using BLINK with 40QTNS, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, results='hide', warning=FALSE}

#GWAS using BLINK with 40QTNS, 75% heritability, 80% training population and 20% testing population
#GWAS
myGAPIT33 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh75QTN40training80=myGAPIT33$PCA
index=myGAPIT33$GWAS[,4]<0.05/length(myGAPIT33$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT33$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 40QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#MAS using the SNPs selected from the BLINK analysis with 40QTNs, 75% heritability, 80% training population and 20% testing population
#MAS
myGAPIT34 <- GAPIT(
Y=mySim$Y[training80,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT34$Pred[,1])
myPred=myGAPIT34$Pred[order,]
ru2MASh75QTN40training80=cor(myPred[testing20,8],mySim$u[testing20])^2
ru2MASh75QTN40training80
```

gBLUP with 40QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 40QTNs, 75% heritability, 80% training population and 20% testing population
myGAPIT35 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT35$Pred[,1])
myPred=myGAPIT35$Pred[order,]
ru2gbluph75QTN40training80=cor(myPred[testing20,5],mySim$u[testing20])^2
ru2gbluph75QTN40training80
```

gBLUP including GWAs-selected SNPs with 40QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 40QTNs, 75% heritability, 80% training population and 20% testing population
myGAPIT36<- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT36$Pred[,1])
myPred=myGAPIT36$Pred[order,]
ru2gblupgwash75QTNs40training80=cor(as.numeric(myPred[testing20,8]),mySim$u[testing20])^2
ru2gblupgwash75QTNs40training80
```

[Bayesian models]{.ul}

Bayes A 40QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 40QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN40training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs40training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesAh75QTNs40training80
```

Bayes B 40QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes B 40QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN40training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesBh75QTNs40training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesBh75QTNs40training80
```

Bayes LASSO 40QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes LASSO 40QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN40training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BL', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesLASSOh75QTNs40training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesLASSOh75QTNs40training80
```

Bayes Ridge Regression 40QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes Ridge regression 40QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN40training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BRR', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesRRh75QTNs40training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesRRh75QTNs40training80
```

**80 QTNs**

Phenotype simulation 75% heritability and 80 QTNs

```{r}
#Phenotype simulation 75% heritability and 80 QTNs
set.seed(99164) 
mySim=GAPIT.Phenotype.Simulation(GD=myGD, GM=myGM,
h2=.75,
NQTN=80, 
QTNDist="normal")
```

GWAS using BLINK with 80QTNS, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, results='hide', warning=FALSE}

#GWAS using BLINK with 80QTNS, 75% heritability, 80% training population and 20% testing population
#GWAS
myGAPIT37 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh75QTN80training80=myGAPIT37$PCA
index=myGAPIT37$GWAS[,4]<0.05/length(myGAPIT37$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT37$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 80QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#MAS using the SNPs selected from the BLINK analysis with 80QTNs, 75% heritability, 80% training population and 20% testing population
#MAS
myGAPIT38 <- GAPIT(
Y=mySim$Y[training80,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT38$Pred[,1])
myPred=myGAPIT38$Pred[order,]
ru2MASh75QTN80training80=cor(myPred[testing20,8],mySim$u[testing20])^2
ru2MASh75QTN80training80
```

gBLUP with 80QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 80QTNs, 75% heritability, 80% training population and 20% testing population
myGAPIT39 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT39$Pred[,1])
myPred=myGAPIT39$Pred[order,]
ru2gbluph75QTN80training80=cor(myPred[testing20,5],mySim$u[testing20])^2
ru2gbluph75QTN80training80
```

gBLUP including GWAs-selected SNPs with 80QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 80QTNs, 75% heritability, 80% training population and 20% testing population
myGAPIT40<- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT40$Pred[,1])
myPred=myGAPIT40$Pred[order,]
ru2gblupgwash75QTNs80training80=cor(as.numeric(myPred[testing20,8]),mySim$u[testing20])^2
ru2gblupgwash75QTNs80training80
```

[Bayesian models]{.ul}

Bayes A 80QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 80QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN80training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs80training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesAh75QTNs80training80
```

Bayes B 80QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes B 80QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN80training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesBh75QTNs80training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesBh75QTNs80training80
```

Bayes LASSO 80QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes LASSO 80QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN80training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BL', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesLASSOh75QTNs80training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesLASSOh75QTNs80training80
```

Bayes Ridge regression 80QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes Ridge regression 80QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN80training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BRR', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesRRh75QTNs80training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesRRh75QTNs80training80
```

**150 QTNs**

Phenotype simulation 75% heritability and 150 QTNs

```{r}
#Phenotype simulation 75% heritability and 120 QTNs
set.seed(99164) 
mySim=GAPIT.Phenotype.Simulation(GD=myGD, GM=myGM,
h2=.75,
NQTN=150, 
QTNDist="normal")
```

GWAS using BLINK with 150QTNS, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, results='hide', warning=FALSE}

#GWAS using BLINK with 150QTNS, 75% heritability, 80% training population and 20% testing population
#GWAS
myGAPIT41 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD,GM=myGM, PCA.total=3,
model="BLINK", 
QTN.position=mySim$QTN.position,
memo="GWAS")

myCVh75QTN150training80=myGAPIT41$PCA
index=myGAPIT41$GWAS[,4]<0.05/length(myGAPIT41$GWAS[,4])
QTN.order=order(abs(mySim$effect),decreasing =T)
index= mySim$QTN.position[QTN.order]+1
myQTN=cbind(myGAPIT41$PCA,myGD[,c(FALSE,index[1:15])])
```

MAS using the SNPs selected from the BLINK analysis with 1500QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#MAS using the SNPs selected from the BLINK analysis with 1500QTNs, 75% heritability, 80% training population and 20% testing population
#MAS
myGAPIT42 <- GAPIT(
Y=mySim$Y[training80,],
CV=myQTN, 
model="GLM", 
SNP.test=FALSE,
memo="MAS")

order=match(mySim$Y[,1],myGAPIT42$Pred[,1])
myPred=myGAPIT42$Pred[order,]
ru2MASh75QTN150training80=cor(myPred[testing20,8],mySim$u[testing20])^2
ru2MASh75QTN150training80
```

gBLUP with 150QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, results='hide', warning=FALSE, message=FALSE}
#gBLUP 150QTNs, 75% heritability, 80% training population and 20% testing population
myGAPIT43 <- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, 
GM=myGM,
PCA.total=3,
model="gBLUP", 
SNP.test=FALSE,
memo="gBLUP")

order=match(mySim$Y[,1],myGAPIT43$Pred[,1])
myPred=myGAPIT43$Pred[order,]
ru2gbluph75QTN150training80=cor(myPred[testing20,5],mySim$u[testing20])^2
ru2gbluph75QTN150training80
```

gBLUP including GWAs-selected SNPs with 150QTNs, 75% heritability, 80% training population and 20% testing population

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#gBLUP including GWAs-selected SNPs, 150QTNs, 75% heritability, 80% training population and 20% testing population
myGAPIT44<- GAPIT(
Y=mySim$Y[training80,],
GD=myGD, GM=myGM,
CV=myQTN, 
model="gBLUP", 
SNP.test=FALSE,
memo="MAS+gBLUP")

order=match(mySim$Y[,1],myGAPIT44$Pred[,1])
myPred=myGAPIT44$Pred[order,]
ru2gblupgwash75QTNs150training80=cor(as.numeric(myPred[testing20,8]),mySim$u[testing20])^2
ru2gblupgwash75QTNs150training80
```

[Bayesian models]{.ul}

Bayes A 150QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes A 150QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN150training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesA', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesAh75QTNs150training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesAh75QTNs150training80
```

Bayes B 150QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes B 150QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN150training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BayesB', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesBh75QTNs150training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesBh75QTNs150training80
```

Bayes LASSO 150QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes LASSO 150QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN150training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BL', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesLASSOh75QTNs150training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesLASSOh75QTNs150training80
```

Bayes Ridge Regression 150QTNs, 75% heritability, 80% training population and 20% testing population

```{r  echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
#Bayes Ridge Regression 150QTNs, 75% heritability, 80% training population and 20% testing population
nIter=2000              
burnIn=1500             
set.seed(99164)
myBGLR =BGLR(y=as.matrix(mySim$Y[training80,2]),
             ETA=list(list(X=myCVh75QTN150training80[training80,-1],model='FIXED', saveEffects=TRUE),
                          list(X=as.matrix(myGD[training80,-1]),model='BRR', saveEffects=TRUE)
             ),
             nIter=nIter,
             burnIn=burnIn)

pred.inf=as.matrix(myGD[testing20,-1])%*%myBGLR$ETA[[2]]$b
ru2BayesRRh75QTNs150training80 <- cor(mySim$u[testing20],pred.inf)^2
ru2BayesRRh75QTNs150training80
```